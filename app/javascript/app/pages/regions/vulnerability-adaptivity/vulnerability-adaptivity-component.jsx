import React, { PureComponent } from 'react';
import PropTypes from 'prop-types';
import {
  Radar,
  RadarChart,
  PolarGrid,
  ResponsiveContainer,
  PolarAngleAxis,
  PolarRadiusAxis
} from 'recharts';

import { Dropdown, Icon } from 'cw-components';
import IndicatorsProvider from 'providers/indicators-provider';
import SectionTitle from 'components/section-title';

import iconInfo from 'assets/icons/info';
import styles from './vulnerability-adaptivity-styles.scss';

const namespace = 'pages.regions.vulnerability-adaptivity';

class VulnerabilityAdaptivity extends PureComponent {
  handleYearChange = selected => {
    const { onFilterChange } = this.props;
    onFilterChange({ year: selected.value });
  };

  renderVulnerabilityClass() {
    const { t, vulnerabilityClass } = this.props;

    return (
      <div>
        {t(`${namespace}.vulnerability-class`)}: {vulnerabilityClass}
      </div>
    );
  }

  renderBox(header, indexName, data) {
    const { selectedYear, t } = this.props;
    const dataFrom = `${t(`${namespace}.data-from`)} ${selectedYear &&
      selectedYear.value}`;

    return (
      <div className={styles.box}>
        <div className={styles.boxHeader}>
          {header}
          <Icon icon={iconInfo} />
        </div>
        <div className={styles.boxBody}>
          <ResponsiveContainer
            width={600}
            aspect={4 / 3}
            margin={{ top: 0, right: 10, left: 10, bottom: 0 }}
          >
            <RadarChart data={data.values}>
              <PolarGrid />
              <PolarAngleAxis dataKey="indicatorName" />
              <PolarRadiusAxis domain={[ 0, 1 ]} />
              <Radar
                dataKey="value"
                stroke="#8884d8"
                fill="#8884d8"
                fillOpacity={0.6}
              />
            </RadarChart>
          </ResponsiveContainer>
        </div>
        <div className={styles.boxFooter}>
          <div className={styles.indexValue}>
            {indexName}: {data.index}
          </div>
          <div className={styles.indexDate}>
            {dataFrom}
          </div>
        </div>
      </div>
    );
  }

  render() {
    const { aci, sei, years, selectedYear, t } = this.props;
    const aciHeader = t(`${namespace}.aci-header`);
    const seiHeader = t(`${namespace}.sei-header`);

    return (
      <div className={styles.page}>
        <SectionTitle
          title={t(`${namespace}.header`)}
          description={t(`${namespace}.description`)}
        />
        <h2>{t(`${namespace}.sub-header`)}</h2>
        <div className={styles.filters}>
          <Dropdown
            key="year"
            label="Year"
            options={years}
            onValueChange={this.handleYearChange}
            value={selectedYear}
            hideResetButton
          />
        </div>
        {this.renderVulnerabilityClass()}
        <div className={styles.container}>
          {this.renderBox(aciHeader, 'ACI', aci)}
          {this.renderBox(seiHeader, 'SEI', sei)}
        </div>
        <IndicatorsProvider />
      </div>
    );
  }
}

VulnerabilityAdaptivity.propTypes = {
  t: PropTypes.func.isRequired,
  aci: PropTypes.object.isRequired,
  sei: PropTypes.object.isRequired,
  years: PropTypes.array,
  selectedYear: PropTypes.object,
  vulnerabilityClass: PropTypes.string,
  onFilterChange: PropTypes.func.isRequired
};

VulnerabilityAdaptivity.defaultProps = {
  years: [],
  selectedYear: null,
  vulnerabilityClass: ''
};

export default VulnerabilityAdaptivity;
